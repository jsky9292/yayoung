<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸€ëŸ¬ë¸Œ ë§ˆì¼“ í†µê³„ ë¶„ì„</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 1.1em;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container dashboard-container">
        <h1 class="text-center mb-5">ğŸ“Š ê¸€ëŸ¬ë¸Œ ë§ˆì¼“ í†µê³„ ë¶„ì„</h1>

        <!-- ìƒë‹¨ í†µê³„ ì¹´ë“œ -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-value">{{ stats.total_items }}</div>
                    <div class="stat-label">ì „ì²´ ìƒí’ˆ</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-value">{{ stats.yahoo_items }}</div>
                    <div class="stat-label">Yahoo Auction</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-value">{{ stats.yayongsa_items }}</div>
                    <div class="stat-label">ì•¼ìš©ì‚¬ ì¹´í˜</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-value">
                        {% if stats.yahoo_avg_price > 0 %}
                            Â¥{{ "{:,}".format(stats.yahoo_avg_price) }}
                        {% else %}
                            -
                        {% endif %}
                    </div>
                    <div class="stat-label">Yahoo í‰ê· ê°€</div>
                </div>
            </div>
        </div>

        <!-- ì°¨íŠ¸ ì„¹ì…˜ -->
        <div class="row">
            <!-- ë¸Œëœë“œë³„ ë¶„í¬ ì°¨íŠ¸ -->
            <div class="col-md-6">
                <div class="chart-container">
                    <h3>ë¸Œëœë“œë³„ ë¶„í¬</h3>
                    <canvas id="brandChart"></canvas>
                </div>
            </div>

            <!-- í¬ì§€ì…˜ë³„ ë¶„í¬ ì°¨íŠ¸ -->
            <div class="col-md-6">
                <div class="chart-container">
                    <h3>í¬ì§€ì…˜ë³„ ë¶„í¬</h3>
                    <canvas id="positionChart"></canvas>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <!-- ì‹ í’ˆ/ì¤‘ê³  ë¹„ìœ¨ -->
            <div class="col-md-6">
                <div class="chart-container">
                    <h3>ìƒí’ˆ ìƒíƒœ</h3>
                    <canvas id="conditionChart"></canvas>
                </div>
            </div>

            <!-- ê°€ê²©ëŒ€ ë¶„í¬ -->
            <div class="col-md-6">
                <div class="chart-container">
                    <h3>ê°€ê²©ëŒ€ ë¶„í¬ (Â¥)</h3>
                    <canvas id="priceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ìƒì„¸ í…Œì´ë¸” -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="chart-container">
                    <h3>ë¸Œëœë“œë³„ ìƒì„¸ í†µê³„</h3>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ë¸Œëœë“œ</th>
                                <th>ìƒí’ˆ ìˆ˜</th>
                                <th>í‰ê·  ê°€ê²©</th>
                                <th>ë¹„ìœ¨</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for brand, data in brand_stats.items() %}
                            <tr>
                                <td>{{ brand }}</td>
                                <td>{{ data.count }}</td>
                                <td>
                                    {% if data.count > 0 %}
                                        Â¥{{ "{:,}".format(data.total_price // data.count) }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>
                                    {% if stats.yahoo_items > 0 %}
                                        {{ "%.1f"|format(data.count * 100 / stats.yahoo_items) }}%
                                    {% else %}
                                        0%
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <a href="/dashboard" class="btn btn-primary btn-lg" style="margin: 10px; padding: 12px 30px; font-weight: 600;">ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>
            <a href="/dashboard/products" class="btn btn-success btn-lg" style="margin: 10px; padding: 12px 30px; font-weight: 600;">ì œí’ˆ ëª©ë¡ ë³´ê¸°</a>
        </div>
    </div>

    <script>
        // ë¸Œëœë“œ ì°¨íŠ¸
        const brandCtx = document.getElementById('brandChart').getContext('2d');
        const brandData = {
            labels: [{% for brand in brand_stats.keys() %}'{{ brand }}',{% endfor %}],
            datasets: [{
                data: [{% for data in brand_stats.values() %}{{ data.count }},{% endfor %}],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.8)',
                    'rgba(54, 162, 235, 0.8)',
                    'rgba(255, 206, 86, 0.8)',
                    'rgba(75, 192, 192, 0.8)',
                    'rgba(153, 102, 255, 0.8)',
                    'rgba(255, 159, 64, 0.8)',
                ]
            }]
        };
        new Chart(brandCtx, {
            type: 'pie',
            data: brandData,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'right',
                    }
                }
            }
        });

        // í¬ì§€ì…˜ ì°¨íŠ¸
        const positionCtx = document.getElementById('positionChart').getContext('2d');
        const positionData = {
            labels: [{% for position in position_stats.keys() %}'{{ position }}',{% endfor %}],
            datasets: [{
                label: 'ìƒí’ˆ ìˆ˜',
                data: [{% for count in position_stats.values() %}{{ count }},{% endfor %}],
                backgroundColor: 'rgba(102, 126, 234, 0.8)',
            }]
        };
        new Chart(positionCtx, {
            type: 'bar',
            data: positionData,
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // ìƒíƒœ ì°¨íŠ¸
        const conditionCtx = document.getElementById('conditionChart').getContext('2d');
        const conditionData = {
            labels: ['ì‹ í’ˆ', 'ì¤‘ê³ '],
            datasets: [{
                data: [{{ condition_stats.new }}, {{ condition_stats.used }}],
                backgroundColor: [
                    'rgba(75, 192, 192, 0.8)',
                    'rgba(255, 159, 64, 0.8)',
                ]
            }]
        };
        new Chart(conditionCtx, {
            type: 'doughnut',
            data: conditionData,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                    }
                }
            }
        });

        // ê°€ê²©ëŒ€ ì°¨íŠ¸
        const priceCtx = document.getElementById('priceChart').getContext('2d');
        const priceData = {
            labels: ['0-20k', '20k-40k', '40k-60k', '60k+'],
            datasets: [{
                label: 'ìƒí’ˆ ìˆ˜',
                data: [
                    {{ price_ranges['0-20k'] }},
                    {{ price_ranges['20-40k'] }},
                    {{ price_ranges['40-60k'] }},
                    {{ price_ranges['60k+'] }}
                ],
                backgroundColor: 'rgba(255, 99, 132, 0.8)',
            }]
        };
        new Chart(priceCtx, {
            type: 'bar',
            data: priceData,
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
</body>
</html>